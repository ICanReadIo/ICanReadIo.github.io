<!doctype html>

<html lang="{% if page.lang %}{{ page.lang }}{% else %}en{% endif %}"> 
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		{% seo %}
		{% feed_meta %}

		<link rel="stylesheet" href="{{ site.baseurl }}/css/screen.css">
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/manifest.json">
		<link rel="preconnect" href="https://fonts.gstatic.com/" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300;700&display=swap">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<!-- Cookie Consent by Osano -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
	<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
	
	{% if page.url == '/en/' %}
		
		{% endif %}
	{% if jekyll.environment == 'production' and site.google_analytics_key != '' %}
		<script type="text/plain" data-cookiecategory="analytics" src="https://www.googleoptimize.com/optimize.js?id=OPT-5XZC76R"></script>

		<!-- Google tag (gtag.js) -->
<script type="text/plain" data-cookiecategory="analytics" async src="https://www.googletagmanager.com/gtag/js?id=G-EBB68TDH78"></script>
<script type="text/plain" data-cookiecategory="analytics">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{ site.google_analytics_key }}');
</script>
		<!-- Hotjar Tracking Code for https://www.icanread.io -->
		<script type="text/plain" data-cookiecategory="analytics">
			(function(h,o,t,j,a,r){
				h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
				h._hjSettings={hjid:2074117,hjsv:6};
				a=o.getElementsByTagName('head')[0];
				r=o.createElement('script');r.async=1;
				r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
				a.appendChild(r);
			})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
		</script>
					<!-- Facebook Pixel Code -->
		<script type="text/plain" data-cookiecategory="marketing">
			!function(f,b,e,v,n,t,s)
			{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
			n.callMethod.apply(n,arguments):n.queue.push(arguments)};
			if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
			n.queue=[];t=b.createElement(e);t.async=!0;
			t.src=v;s=b.getElementsByTagName(e)[0];
			s.parentNode.insertBefore(t,s)}(window, document,'script',
			'https://connect.facebook.net/en_US/fbevents.js');
			fbq('init', '950196802426464');
			fbq('track', 'PageView');
		</script>
		<noscript><img height="1" width="1" style="display:none"
			src="https://www.facebook.com/tr?id=950196802426464&ev=PageView&noscript=1"
		/></noscript>
		<!-- End Facebook Pixel Code -->
		<!-- Reddit Pixel -->
		<script type="text/plain" data-cookiecategory="analytics">
		!function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}(window,document);rdt('init','t2_egxeuepj');rdt('track', 'PageVisit');
		</script>
		<!-- DO NOT MODIFY -->
		<!-- End Reddit Pixel -->
		    <!--Start of Tawk.to Script-->
<script type="text/plain" data-cookiecategory="preferences">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
if(localStorage.getItem('user')){  
  Tawk_API.visitor = {
	email : localStorage.getItem('user')
  };
}

(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6145ee24d326717cb68226cd/1ffsikfpa';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
var Tawk_API = window.Tawk_API || {};
Tawk_API.onChatStarted = function(){
Tawk_API.setAttributes({
	  'userAgent' : navigator.userAgent
  }, function(error){console.log(error)});
};
</script>
<!--End of Tawk.to Script-->


<script type="text/plain" data-cookiecategory="analytics">
	!function (w, d, t) {
	  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
	
	  ttq.load('C5K92O2EIQRN3OTMJIGG');
	  ttq.page();
	}(window, document, 'ttq');
</script>
	
	
	{% endif %}

	<!-- Cookie Consent Initialization -->
	<script>
	window.addEventListener("load", function(){
		// Determine language from Jekyll
		var currentLang = "{% if page.lang %}{{ page.lang }}{% else %}en{% endif %}";
		
		// Helper function to enable all scripts (for non-EU users)
		function enableAllTracking() {
			var scripts = document.querySelectorAll('script[type="text/plain"][data-cookiecategory]');
			for (var i = 0; i < scripts.length; i++) {
				var script = scripts[i];
				var newScript = document.createElement('script');
				
				// Copy all attributes except type and data-cookiecategory
				for (var j = 0; j < script.attributes.length; j++) {
					var attr = script.attributes[j];
					if (attr.name !== 'type' && attr.name !== 'data-cookiecategory') {
						newScript.setAttribute(attr.name, attr.value);
					}
				}
				
				// Set the script content
				if (script.src) {
					newScript.src = script.src;
				} else {
					newScript.text = script.text;
				}
				
				// Replace the old script with the new one
				script.parentNode.replaceChild(newScript, script);
			}
		}
		
		// Cookie Consent configuration
		var cookieConsentConfig = {
			"palette": {
				"popup": {
					"background": "#237afc",
					"text": "#ffffff"
				},
				"button": {
					"background": "#ffffff",
					"text": "#237afc"
				}
			},
			"type": "opt-in",
			"content": {},
			"location": true  // Enable geolocation detection
		};

		// Multi-language support
		if (currentLang === "en") {
			cookieConsentConfig.content = {
				"message": "This website uses cookies to improve your experience, analyze site traffic, and provide personalized content.",
				"dismiss": "Got it!",
				"allow": "Allow cookies",
				"deny": "Decline",
				"link": "Learn more",
				"href": "/en/privacy.html",
				"policy": "Cookie Policy"
			};
		} else if (currentLang === "af") {
			cookieConsentConfig.content = {
				"message": "Hierdie webwerf gebruik koekies om jou ervaring te verbeter, webwerf-verkeer te ontleed en persoonlike inhoud te verskaf.",
				"dismiss": "Verstaan!",
				"allow": "Laat koekies toe",
				"deny": "Weier",
				"link": "Leer meer",
				"href": "/af/privacy.html",
				"policy": "Koekiebeleid"
			};
		} else if (currentLang === "sv") {
			cookieConsentConfig.content = {
				"message": "Denna webbplats använder cookies för att förbättra din upplevelse, analysera webbplatstrafik och tillhandahålla personligt innehåll.",
				"dismiss": "Jag förstår!",
				"allow": "Tillåt cookies",
				"deny": "Neka",
				"link": "Läs mer",
				"href": "/sv/privacy.html",
				"policy": "Cookie-policy"
			};
		}

		// Fetch user location and initialize accordingly
		fetch('https://ipapi.co/json/')
			.then(function(response) { return response.json(); })
			.then(function(data) {
				var countryCode = data.country_code;
				
				// EU countries + UK + EEA + California
				var privacyRegions = [
					'AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR',
					'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL',
					'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE', 'GB', // EU + UK
					'IS', 'LI', 'NO' // EEA
				];
				
				// Check if user is from California (US state detection needs additional logic)
				var requiresConsent = privacyRegions.indexOf(countryCode) !== -1;
				
				// Special handling for US users - show banner for California residents
				if (countryCode === 'US') {
					requiresConsent = true; // Show banner for all US users (CCPA)
				}
				
				if (requiresConsent) {
					// User is in a privacy-regulated region - show consent banner
					console.log('User is in privacy region (' + countryCode + ') - showing consent banner');
					
					// Initialize Cookie Consent
					window.cookieconsent.initialise(cookieConsentConfig, function(popup) {
						// Helper function to enable scripts for a category
						function enableScripts(category) {
							var scripts = document.querySelectorAll('script[type="text/plain"][data-cookiecategory="' + category + '"]');
							for (var i = 0; i < scripts.length; i++) {
								var script = scripts[i];
								var newScript = document.createElement('script');
								
								// Copy all attributes except type and data-cookiecategory
								for (var j = 0; j < script.attributes.length; j++) {
									var attr = script.attributes[j];
									if (attr.name !== 'type' && attr.name !== 'data-cookiecategory') {
										newScript.setAttribute(attr.name, attr.value);
									}
								}
								
								// Set the script content
								if (script.src) {
									newScript.src = script.src;
								} else {
									newScript.text = script.text;
								}
								
								// Replace the old script with the new one
								script.parentNode.replaceChild(newScript, script);
							}
						}

						// Enable scripts based on consent status
						if (popup.hasConsented()) {
							// User accepted cookies - enable all tracking
							enableScripts('analytics');
							enableScripts('marketing');
							enableScripts('preferences');
						}
					});
				} else {
					// User is NOT in a privacy-regulated region - auto-enable tracking
					console.log('User is outside privacy regions (' + countryCode + ') - enabling tracking automatically');
					enableAllTracking();
				}
			})
			.catch(function(error) {
				// If geolocation fails, default to showing consent banner (safer)
				console.log('Geolocation failed, showing consent banner as fallback');
				window.cookieconsent.initialise(cookieConsentConfig, function(popup) {
					if (popup.hasConsented()) {
						enableAllTracking();
					}
				});
			});
	});
	</script>
</head>
<body>
		<header>
			<div class="container">
				<div class="company-name"><a href="{{ site.baseurl }}{% if page.lang %}/{{page.lang}}{% endif %}/">
					<picture>
						<source srcset="{{ site.baseurl }}/images/logo-with-slogan.webp" type="image/webp">		
						<img src="{{ site.baseurl }}/images/logo-with-slogan.png" alt="IcanRead" />
					</picture>
				</a></div>
				{% include navigation.html %}
			</div>
		</header>
		{{ content }}
		<footer>
			<div class="container">
				<p class="editor-link"><a href="cloudcannon:collections/_data/footer.yml" class="btn"><strong>&#9998;</strong> Edit footer</a></p>
				<div class="footer-columns">
					{% if page.lang == "sv" %}
						{% for column in site.data.sv.footer %}
						<ul class="footer-links">
							{% for link in column.links %}
								<li><a {% if link.new_window %}target="_blank"{% endif %} href="{% include relative-src.html src=link.link %}" {% if link.social_icon %}class="{{ link.social_icon }}-icon"{% endif %}>
									{% if link.social_icon %}
										{% include social-icon.html icon=link.social_icon %}
									{% endif %}
									{{ link.name }}</a></li>
							{% endfor %}
						</ul>
						{% endfor %}
					{% elsif page.lang == "af" %}
						{% for column in site.data.af.footer %}
						<ul class="footer-links">
							{% for link in column.links %}
								<li><a {% if link.new_window %}target="_blank"{% endif %} href="{% include relative-src.html src=link.link %}" {% if link.social_icon %}class="{{ link.social_icon }}-icon"{% endif %}>
									{% if link.social_icon %}
										{% include social-icon.html icon=link.social_icon %}
									{% endif %}
									{{ link.name }}</a></li>
							{% endfor %}
						</ul>
						{% endfor %}
					{% else %}	
					{% for column in site.data.footer %}
					<ul class="footer-links">
						{% for link in column.links %}
							<li><a {% if link.new_window %}target="_blank"{% endif %}  rel="nofollow" href="{% include relative-src.html src=link.link %}" {% if link.social_icon %}class="{{ link.social_icon }}-icon"{% endif %}>
								{% if link.social_icon %}
									{% include social-icon.html icon=link.social_icon %}
								{% endif %}
								{{ link.name }}</a></li>
						{% endfor %}
					</ul>
					{% endfor %}
					{% endif %}	
				</div>
				<p class="copyright">&copy; {{ site.time | date: '%Y' }} IcanRead.  • <a rel="nofollow" href="https://cloudcannon.com/">Template by CloudCannon</a></p>
			</div>
		</footer>
		<script>
			document.getElementById("open-nav").onclick = function () {
				document.body.classList.toggle("nav-open");
				return false;
			};
		</script>
	</body>
</html>
